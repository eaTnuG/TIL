# HTTPS 작동 방식

동명의 [만화?](https://howhttps.works/ko/)를 보고 배운 것을 정리했다.

## 왜 HTTPS가 필요할까

HTTPS가 필요한 이유는 통신에서 다음의 3가지를 보장하기 위함이다.

_**정보 보호, 무결성, 식별**_

**정보 보호**란 정보를 다른 사람이 가로채지 못한다는 것을 의미하고 **무결성**은 전달된 메시지가 중간에 위변조 되지 않았다는 것을 의미하며 마지막으로 **식별**은 서로 통신을 하고 있는 상배당이 정당한, 내가 생각하고있는 그 상대라는 것을 증명하는 것이다.

## HTTP는 이를 어떻게 제공하나

HTTPS는 암호화를 통해 이 문제를 해결한다. 암호화란 기본적으로 키 값으로 평문을 암호화,복호화 해서 키가 없는 사람이 내용을 알 수 없게 하는 기법이다. 암호화에도 여러가지 방법이 있는데 가장 기본적인 방법이 대칭키이다. 대칭키는 하나의 키로 암호화, 복호화를 모두 수행하는 방법인데, 단순하고 이해하기 쉽지만 하나로 모든걸 하는 키를 통신하려는 상대방과 안전하게 공유하기가 어렵다. 또 다른 방법으로는 비대칭키 방법이 있다. 비대칭 키 방법은 말 그대로 암호화를 하는 키와 복호화를 하는 키가 따로 있는 방법이다. 이렇게 되면 암호화를 하는 키는 상대에게 공유하고, 복호하를 하는 키는 내가 가지고 있으면 안전한 통신이 가능하다. 이때 상대에게 공유하는 암호화를 담당하는 키를 공개키, 내가 가지고 있는 복호화를 담당하는 키를 비공개키 라고한다.

## HTTPS 통신 과정

브라우저는 처음 호스팅 서버에 접속할 때 핸드쉐이킹 이라는 과정을 통해 HTTPS 통신을 위한 기반을 수립한다. 핸드쉐이킹이 어떻게 이루어지는지 자세히 살펴보자.

1. 우선 클라이언트가 서버에게 SSL/TLS 버전과 암호화 알고리즘 목록(Cipher-Suite)을 전송한다.
1. 이제 서버에서는 해당 알고리즘 목록 중 선호하는 것을 선택하고, 본인의 공개키가 담긴 인증서를 회신하여 본인이 신뢰할 수 있는, 요청을 보낸 서버가 맞는지 확인시켜준다.
1. 클라이언트에서는 인증서가 신뢰할 수 있는 인증서인지 확인한 다음 추후에 사용할 `pre-master-key`를 생성한다. 이 키를 서버의 공개키로 암호화하여 전송한다.
1. 서버는 본인의 개인키로 이 `pre-master-key`를 복호화하여 저장한다.
1. 이제 클라이언트가 `pre-master-key`로 암호화,복호화를 테스트하고 앞으로의 모든 통신은 해당 키를 통해 암호화가 이루어진다.

## HTTPS, SSL, TLS

HTTPS는 Secure한 HTTP 통신을 의미한다. 이때까지 알아본 통신이 HTTPS이다. SSL과 TLS는 모두 암호화를 위한 프로토콜인데, SSL이 처음 나왔었고, 문제가 있었으며, 다른 이들이 넘겨받았는데, TLS로 넘어가는 중이다. 그냥 둘 다 암호화 프로토콜이라는 것 정도만 알면 될듯.

## 인증기관

인증기관은 인증서 발급, 인증서 소유자의 신원 확인, 인증서가 유효하다는 증거 제공을 해주는 기관으로, HTTPS 통신에 기여하는 중립적인 제3자이다. `Symantec`, `Comodo`, `Let's Encrypt` 등이 있다. 가장 권위있는 RootCA가 있고 다음 단계에 일반 사용자들과 직접 커넥트하는 MiddleCA가 있어서 인증서를 2중으로 사용하는 체인형태의 인증 흐름이 발생하는 것 같다.
